<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OZZ Catalog Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Basic styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .control-panel {
            max-width: 800px;
            margin: 0 auto 30px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            margin: 20px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
        }
        
        /* Print Preview */
        .print-preview {
            max-width: 210mm;
            margin: 0 auto;
        }
        
        /* Print Styles */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            
            .control-panel {
                display: none;
            }
            
            .page {
                width: 210mm;
                height: 297mm;
                margin: 0;
                padding: 15mm;
                page-break-after: always;
                position: relative;
                box-sizing: border-box;
            }
            
            .page:last-child {
                page-break-after: avoid;
            }
            
            .page-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding-bottom: 5mm;
                margin-bottom: 5mm;
                border-bottom: 2px solid #333;
            }
            
            .page-header h2 {
                margin: 0;
                font-size: 16pt;
            }
            
            .page-number {
                font-size: 10pt;
                color: #666;
            }
            
            .category-header {
                background: #333;
                color: white;
                padding: 3mm 5mm;
                margin: 5mm 0;
                font-size: 14pt;
                font-weight: bold;
            }
            
            .products-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 5mm;
            }
            
            .product-card {
                border: 1px solid #ddd;
                padding: 3mm;
                height: 55mm;
                display: flex;
                overflow: hidden;
            }
            
            .product-image {
                width: 35%;
                background: #f8f8f8;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 3mm;
            }
            
            .product-image img {
                max-width: 100%;
                max-height: 100%;
                object-fit: contain;
            }
            
            .no-image {
                text-align: center;
                color: #999;
                font-size: 10pt;
            }
            
            .product-details {
                flex: 1;
                display: flex;
                flex-direction: column;
            }
            
            .product-title {
                font-size: 11pt;
                font-weight: bold;
                margin-bottom: 2mm;
                line-height: 1.2;
            }
            
            .product-sku {
                font-size: 9pt;
                color: #666;
                margin-bottom: 2mm;
            }
            
            .product-category {
                font-size: 9pt;
                color: #666;
                margin-bottom: auto;
            }
            
            .product-price {
                font-size: 14pt;
                font-weight: bold;
                color: #d32f2f;
                margin-top: 2mm;
            }
            
            .price-was {
                font-size: 10pt;
                color: #999;
                text-decoration: line-through;
            }
            
            .price-save {
                font-size: 9pt;
                color: #388e3c;
                font-weight: bold;
            }
            
            .page-footer {
                position: absolute;
                bottom: 10mm;
                left: 15mm;
                right: 15mm;
                font-size: 8pt;
                color: #666;
                border-top: 1px solid #ddd;
                padding-top: 3mm;
            }
            
            .footer-text {
                margin-bottom: 2mm;
                line-height: 1.3;
            }
            
            .footer-bottom {
                display: flex;
                justify-content: space-between;
                font-weight: bold;
            }
        }
        
        @page {
            size: A4;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <h1>OZZ Catalog Generator</h1>
        
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="loadCatalog()" id="loadBtn">üìÅ Load JULY PROMO.xlsx</button>
            <button onclick="generateCatalog()" id="generateBtn" disabled>üìÑ Generate Catalog</button>
            <button onclick="window.print()" id="printBtn" disabled>üñ®Ô∏è Print / Save PDF</button>
        </div>
        
        <div class="status" id="status">
            Ready to load catalog data...
        </div>
        
        <div id="categoryList" style="margin-top: 20px;"></div>
    </div>
    
    <div id="printContent" class="print-preview"></div>

    <script>
        let allProducts = [];
        let categories = [];
        
        async function loadCatalog() {
            const loadBtn = document.getElementById('loadBtn');
            const status = document.getElementById('status');
            
            loadBtn.disabled = true;
            status.textContent = 'Loading Excel file...';
            
            try {
                const response = await fetch('./JULY PROMO.xlsx');
                if (!response.ok) {
                    throw new Error('Could not find JULY PROMO.xlsx in the same folder');
                }
                
                const data = await response.arrayBuffer();
                const workbook = XLSX.read(data);
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // Process products
                allProducts = jsonData
                    .filter(row => row.SKU && row['PRODUCT '] && row.PRICE && row.CATEGORY)
                    .map(row => ({
                        sku: String(row.SKU).trim(),
                        description: String(row['PRODUCT '] || row.PRODUCT || '').trim(),
                        price: parseFloat(row.PRICE) || 0,
                        category: String(row.CATEGORY).trim().toUpperCase()
                    }))
                    .filter(p => p.price > 0);
                
                // Get categories
                categories = [...new Set(allProducts.map(p => p.category))].sort();
                
                // Show category list
                showCategories();
                
                document.getElementById('generateBtn').disabled = false;
                status.innerHTML = `<strong>‚úì Loaded ${allProducts.length} products in ${categories.length} categories</strong>`;
                
            } catch (error) {
                status.innerHTML = `<strong style="color: red;">Error: ${error.message}</strong>`;
                console.error(error);
            } finally {
                loadBtn.disabled = false;
            }
        }
        
        function showCategories() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '<h3>Categories:</h3>';
            
            categories.forEach(cat => {
                const count = allProducts.filter(p => p.category === cat).length;
                const label = document.createElement('label');
                label.style.display = 'block';
                label.style.margin = '5px 0';
                label.innerHTML = `
                    <input type="checkbox" checked value="${cat}" class="category-cb">
                    ${cat} (${count} products)
                `;
                categoryList.appendChild(label);
            });
        }
        
        function generateCatalog() {
            const selectedCats = Array.from(document.querySelectorAll('.category-cb:checked'))
                .map(cb => cb.value);
            
            if (selectedCats.length === 0) {
                alert('Please select at least one category');
                return;
            }
            
            const filteredProducts = allProducts.filter(p => selectedCats.includes(p.category));
            
            // Sort by category then description
            filteredProducts.sort((a, b) => {
                if (a.category !== b.category) {
                    return a.category.localeCompare(b.category);
                }
                return a.description.localeCompare(b.description);
            });
            
            // Generate pages
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = '';
            
            // Add header page
            printContent.appendChild(createHeaderPage());
            
            // Group by category
            const grouped = {};
            filteredProducts.forEach(p => {
                if (!grouped[p.category]) grouped[p.category] = [];
                grouped[p.category].push(p);
            });
            
            // Create product pages
            let pageNum = 2;
            Object.entries(grouped).forEach(([category, products]) => {
                for (let i = 0; i < products.length; i += 8) {
                    const pageProducts = products.slice(i, i + 8);
                    const showCategoryHeader = i === 0;
                    printContent.appendChild(createProductPage(pageProducts, category, showCategoryHeader, pageNum++));
                }
            });
            
            // Update page numbers
            const totalPages = printContent.querySelectorAll('.page').length;
            printContent.querySelectorAll('.total-pages').forEach(el => {
                el.textContent = totalPages;
            });
            
            document.getElementById('printBtn').disabled = false;
            document.getElementById('status').innerHTML = 
                `<strong>‚úì Generated ${totalPages} pages with ${filteredProducts.length} products</strong>`;
        }
        
        function createHeaderPage() {
            const page = document.createElement('div');
            page.className = 'page';
            page.innerHTML = `
                <div style="display: flex; flex-direction: column; justify-content: center; height: 100%; text-align: center;">
                    <h1 style="font-size: 48pt; color: #d32f2f; margin: 20mm 0 10mm;">JULY 2025 PROMO</h1>
                    <p style="font-size: 16pt; color: #666; margin-bottom: 20mm;">Exclusive Deals on Premium Home & Kitchen Products</p>
                    
                    <div style="background: #f5f5f5; padding: 10mm; margin: 10mm 0; text-align: left;">
                        <h2 style="font-size: 18pt; margin-bottom: 5mm;">OZZ CASH & CARRY</h2>
                        <p style="font-size: 12pt; line-height: 1.5;">
                            40 Mazeppa & Gull Street<br>
                            Durban, KwaZulu-Natal 4001<br>
                            South Africa
                        </p>
                        <p style="font-size: 12pt; margin-top: 5mm;">
                            <strong>Phone:</strong> +27 31 332 7192<br>
                            <strong>Email:</strong> info@ozzsa.com<br>
                            <strong>Website:</strong> www.ozzsa.com
                        </p>
                    </div>
                    
                    <div style="background: #fff3cd; border-left: 4mm solid #ffc107; padding: 5mm; margin: 10mm 0;">
                        <p style="font-size: 11pt; margin: 0;">
                            <strong>üìç Collection & Delivery:</strong><br>
                            Promotional prices are valid for collection only at 40 Mazeppa Street, Durban.<br>
                            Delivery is available at an additional charge.
                        </p>
                    </div>
                </div>
                
                <div class="page-footer">
                    <div class="footer-text">
                        While Ozz Cash and Carry will always attempt to have sufficient stock available, the above prices are valid till stocks last. 
                        Ozz Cash and Carry reserves the right to limit quantities. Errors and omissions excepted. All items include VAT where applicable. 
                        Images are for illustrative purposes only.
                    </div>
                    <div class="footer-bottom">
                        <span>OZZ Cash & Carry ‚Ä¢ July 2025 Catalog</span>
                        <span>Page 1 of <span class="total-pages">-</span> ‚Ä¢ Version 2.2</span>
                    </div>
                </div>
            `;
            return page;
        }
        
        function createProductPage(products, category, showHeader, pageNum) {
            const page = document.createElement('div');
            page.className = 'page';
            
            let html = `
                <div class="page-header">
                    <h2>July 2025 Promotional Catalog</h2>
                    <span class="page-number">Page ${pageNum} of <span class="total-pages">-</span></span>
                </div>
            `;
            
            if (showHeader) {
                html += `<div class="category-header">${category}</div>`;
            }
            
            html += '<div class="products-grid">';
            
            // Always create 8 slots
            for (let i = 0; i < 8; i++) {
                if (i < products.length) {
                    const p = products[i];
                    const originalPrice = (p.price * 1.2).toFixed(2);
                    const savePercent = Math.round(((originalPrice - p.price) / originalPrice) * 100);
                    
                    html += `
                        <div class="product-card">
                            <div class="product-image">
                                <div class="no-image">üì¶<br>No Image</div>
                            </div>
                            <div class="product-details">
                                <div class="product-title">${p.description}</div>
                                <div class="product-sku">SKU: ${p.sku}</div>
                                <div class="product-category">${p.category}</div>
                                <div class="product-price">R${p.price.toFixed(2)}</div>
                                <div class="price-was">Was R${originalPrice}</div>
                                <div class="price-save">SAVE ${savePercent}%</div>
                            </div>
                        </div>
                    `;
                } else {
                    html += '<div></div>'; // Empty slot
                }
            }
            
            html += `
                </div>
                
                <div class="page-footer">
                    <div class="footer-text">
                        While Ozz Cash and Carry will always attempt to have sufficient stock available, the above prices are valid till stocks last. 
                        Ozz Cash and Carry reserves the right to limit quantities. Errors and omissions excepted. All items include VAT where applicable. 
                        Images are for illustrative purposes only.
                    </div>
                    <div class="footer-bottom">
                        <span>OZZ Cash & Carry ‚Ä¢ +27 31 332 7192</span>
                        <span>www.ozzsa.com ‚Ä¢ Version 2.2</span>
                    </div>
                </div>
            `;
            
            page.innerHTML = html;
            return page;
        }
    </script>
</body>
</html>
